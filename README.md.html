<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사다리 게임</title>
    <style>
        /* --- CSS --- */
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f4f4f9;
            padding: 20px;
        }
        h1 {
            color: #333;
        }
        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .controls label {
            margin-right: 10px;
            font-weight: bold;
        }
        .controls input[type="number"] {
            padding: 5px;
            width: 60px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .controls button {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .controls button:hover {
            background-color: #45a049;
        }

        #ladder-container {
            position: relative;
            background-color: #fff;
            border: 2px solid #333;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        /* 사다리 선 */
        .ladder-line {
            position: absolute;
            background-color: #333;
        }

        /* 시작/종료 지점 표시 */
        .start-point, .end-point {
            position: absolute;
            width: 30px;
            text-align: center;
            cursor: pointer;
            padding: 5px 0;
            border-radius: 4px;
            font-weight: bold;
            transition: background-color 0.2s;
            user-select: none;
        }
        .start-point {
            top: -30px; /* 컨테이너 위로 */
            background-color: #eee;
            border: 1px solid #ccc;
        }
        .start-point:hover {
            background-color: #ddd;
        }
        .end-point {
            bottom: -30px; /* 컨테이너 아래로 */
        }
        .result-message {
            margin-top: 20px;
            font-size: 1.2em;
            color: #D9534F;
            font-weight: bold;
        }

        /* 말 (Player Piece) */
        .player {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #FF9800;
            border-radius: 50%;
            top: -40px; /* 시작 위치 */
            transform: translateX(-50%);
            transition: top 0.5s ease-in-out, left 0.5s ease-in-out;
            z-index: 10;
        }
    </style>
</head>
<body>

    <h1>온라인 사다리 게임</h1>

    <div class="controls">
        <label for="numLines">가로줄 (칸 수):</label>
        <input type="number" id="numLines" value="5" min="2" max="20">
        <label for="numRungs">세로줄 (높이):</label>
        <input type="number" id="numRungs" value="10" min="3" max="30">
        <button onclick="initializeLadder()">사다리 생성</button>
    </div>

    <div id="ladder-container">
        <!-- 사다리 및 시작/종료 지점이 여기에 그려집니다 -->
    </div>

    <div id="result" class="result-message"></div>

    <script>
        // --- JavaScript ---

        const CONTAINER_ID = 'ladder-container';
        const START_HEIGHT = 300; // 사다리 총 높이 (픽셀)
        const START_WIDTH = 500;  // 사다리 총 너비 (픽셀)
        const GAP_MIN = 50;       // 최소 가로 간격
        const GAP_MAX = 100;      // 최대 가로 간격

        let numLines = 5; // 가로줄 수 (칸 수)
        let numRungs = 10; // 세로줄 수 (높이)
        let rungHeight; // 각 세로줄의 높이
        let lineSpacing; // 가로줄 간의 간격 (세로줄 간의 간격)

        const container = document.getElementById(CONTAINER_ID);
        const resultDiv = document.getElementById('result');

        // 사다리 초기화 및 생성
        function initializeLadder() {
            // 설정값 가져오기
            numLines = parseInt(document.getElementById('numLines').value);
            numRungs = parseInt(document.getElementById('numRungs').value);

            if (numLines < 2 || numRungs < 3) {
                alert("가로줄은 최소 2개, 세로줄은 최소 3개 이상이어야 합니다.");
                return;
            }

            container.innerHTML = ''; // 이전 내용 초기화
            resultDiv.textContent = ''; // 결과 초기화

            // 사다리 크기 설정
            rungHeight = START_HEIGHT / numRungs;
            // 가로줄 간격 (총 너비를 칸 수로 나눔)
            lineSpacing = START_WIDTH / (numLines + 1);

            container.style.width = `${START_WIDTH}px`;
            container.style.height = `${START_HEIGHT + 60}px`; // 여유 공간 포함

            // 1. 사다리 줄 그리기
            drawLadder();

            // 2. 시작/종료 지점 생성 및 클릭 이벤트 등록
            createPoints();
        }

        function drawLadder() {
            // 임시 저장소: 각 가로줄에서 오른쪽으로 이동할지 (true) 왼쪽으로 이동할지 (false) 결정
            let connections = [];

            // 사다리 세로줄을 numLines + 1 개 (양쪽 끝 포함) 만큼 그려야 함.
            // 실제 가로 막대는 numLines 개가 필요.
            for (let i = 0; i < numRungs; i++) {
                // 각 세로줄(가로 막대)의 위치를 저장할 배열 초기화
                if (i === 0) {
                    connections = Array(numLines).fill(false);
                } else {
                    // 새로운 층의 연결 정보 생성
                    const newConnections = Array(numLines).fill(false);
                    
                    // 이전 층의 연결 정보를 기반으로 현재 층의 연결 생성
                    for (let j = 0; j < numLines; j++) {
                        const canGoRight = j < numLines - 1 && !connections[j + 1]; // 오른쪽 막대 연결 가능 & 오른쪽 막대가 이미 왼쪽으로 연결되지 않았는지
                        const canGoLeft = j > 0 && !connections[j - 1]; // 왼쪽 막대 연결 가능 & 왼쪽 막대가 이미 오른쪽으로 연결되지 않았는지
                        const canStay = !canGoRight && !canGoLeft; // 양쪽에 연결되지 않은 경우

                        if (canStay) {
                             // 아무데도 연결 안됨
                             newConnections[j] = false; 
                        } else if (canGoRight && Math.random() < 0.5) {
                            // 오른쪽으로 연결 시도 (단, 오른쪽에 이미 연결된 것이 없다면)
                            newConnections[j] = true;
                        } else if (canGoLeft && Math.random() < 0.5) {
                            // 왼쪽으로 연결 시도 (단, 왼쪽에 이미 연결된 것이 없다면)
                            newConnections[j] = false;
                        } else {
                            // 연결 없음
                            newConnections[j] = false;
                        }
                    }
                    connections = newConnections;
                }


                // **실제 사다리 그리기**
                
                // 1. 세로 기둥 (전체 numLines + 1 개 필요)
                for (let k = 0; k <= numLines; k++) {
                    const x = k * lineSpacing;
                    const y = i * rungHeight;

                    const rungDiv = document.createElement('div');
                    rungDiv.className = 'ladder-line';
                    rungDiv.style.width = '2px';
                    rungDiv.style.height = `${rungHeight + 2}px`; // 약간 겹치게 하여 이음매 제거
                    rungDiv.style.left = `${x}px`;
                    rungDiv.style.top = `${y - 1}px`; // 1px 위로 올려서 약간 겹치게 함
                    container.appendChild(rungDiv);
                }

                // 2. 가로 연결대 (numLines 
